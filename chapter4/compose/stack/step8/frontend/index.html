<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아이템 관리</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body { padding-top: 4.5rem; }
        .container { max-width: 720px; }
    </style>
</head>
<body>
    <!-- 네비게이션 바 -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">아이템 관리 시스템</a>
        </div>
    </nav>
    <main class="container">
        <!-- 아이템 등록 섹션 -->
        <div class="my-4 p-5 bg-light rounded-3">
            <h1 class="display-5">새 아이템 등록</h1>
            <p class="lead">아래 양식을 사용하여 새로운 아이템을 추가하세요.</p>
            <form id="addItemForm">
                <div class="mb-3">
                    <label for="itemName" class="form-label">아이템 이름</label>
                    <input type="text" class="form-control" id="itemName" placeholder="예: 신라면" required>
                </div>
                <button type="submit" class="btn btn-primary">등록하기</button>
            </form>
        </div>
        <!-- 아이템 목록 섹션 -->
        <div class="mt-5">
            <h2>등록된 아이템 목록</h2>
            <p>현재 데이터베이스에 저장된 아이템들의 목록입니다.</p>
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">이름</th>
                    </tr>
                </thead>
                <tbody id="itemsList">
                </tbody>
            </table>
        </div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const addItemForm = document.getElementById('addItemForm');
            const itemNameInput = document.getElementById('itemName');
            const itemsList = document.getElementById('itemsList');

            async function fetchItems() {
                try {
                    const response = await fetch('/api/items');
                    if (!response.ok) throw new Error('서버 응답 오류');
                    const data = await response.json();
                    let rowsHtml = '';
                    if (data.items && data.items.length > 0) {
                        data.items.forEach(item => {
                            rowsHtml += `<tr><td>${item[0]}</td><td>${item[1]}</td></tr>`;
                        });
                    } else {
                        rowsHtml = '<tr><td colspan="2" class="text-center">등록된 아이템이 없습니다.</td></tr>';
                    }
                    itemsList.innerHTML = rowsHtml;
                } catch (error) {
                    console.error('아이템 로딩 오류:', error);
                    alert(error.message);
                }
            }

            async function addItem(name) {
                try {
                    const response = await fetch(`/api/items?name=${encodeURIComponent(name)}`, { method: 'POST' });
                    if (!response.ok) throw new Error('아이템 등록 실패');
                    itemNameInput.value = '';
                    fetchItems();
                } catch (error) {
                    console.error('아이템 등록 오류:', error);
                    alert(error.message);
                }
            }

            addItemForm.addEventListener('submit', function (event) {
                event.preventDefault();
                const itemName = itemNameInput.value.trim();
                if (itemName) addItem(itemName);
                else alert('아이템 이름을 입력해주세요.');
            });

            fetchItems();
        });
    </script>
</body>
</html>
