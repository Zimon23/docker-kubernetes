### Secret이란?

  Secret은 비밀번호, OAuth 토큰, SSH 키, API 키 등 민감하고 기밀성이 높은 데이터를 저장하고 관리하기 위해 설계된 쿠버네티스 오브젝트입니다.

  ConfigMap과의 핵심적인 차이점:
  기능적으로는 키-값(key-value) 쌍으로 데이터를 저장한다는 점에서 ConfigMap과 매우 유사합니다. 하지만 사용 목적이 명확하게 다릅니다.

   * ConfigMap: 일반 설정 정보 (애플리케이션 모드, URL 등)
   * Secret: 암호, 키, 토큰 등 절대 외부에 노출되면 안 되는 민감 정보

  쿠버네티스는 Secret 오브젝트에 대해 추가적인 보안 조치(예: 특정 사용자만 읽도록 접근 제어, 디스크에 저장하지 않도록 제어 등)를 적용할 수 있으므로, 민감 정보는 반드시 Secret에 저장해야 합니다.

  ⚠️ 매우 중요한 보안 경고: Base64는 암호화가 아닙니다!

  Secret에 저장되는 데이터 값은 기본적으로 Base64로 인코딩(encoding)되어 화면에 표시됩니다. 이것은 단순히 데이터를 안전하게 전송하기 위한 인코딩 방식일 뿐, 절대 암호화(encryption)가 아닙니다.

  kubectl get secret ... -o yaml 명령어로 Secret의 내용을 볼 수 있는 권한이 있는 사람이라면 누구나 간단한 명령어로 원래 값을 쉽게 디코딩할 수 있습니다.

  > 따라서 Secret의 진짜 보안은 RBAC(역할 기반 접근 제어)를 통해 "누가 Secret을 읽을 수 있는가"를 엄격하게 제어하는 것에서 시작됩니다. 또한, 운영 환경에서는 클러스터 관리자가 etcd 데이터베이스에 저장 시 암호화(Encryption at Rest) 설정을 활성화해야만 데이터가 안전하게 보호됩니다. (10 장에서 학습 예정)

  ---

2. Secret 생성 방법

    1. `literal`(리터럴) 값으로 직접 만들기 (가장 간단)
    2. 파일로부터 만들기
    3. YAML 파일로 선언하여 만들기 (권장)


방법 1: `literal`(리터럴) 값으로 직접 만들기 (가장 간단)

  명령어 라인에서 직접 키와 값을 지정하여 Secret을 생성합니다.
```
#`literal`(리터럴) 값으로 직접 만들기
kubectl create secret generic my-db-credentials \
   --from-literal=DB_USER=kosa \
   --from-literal=DB_PASSWORD='kosa1004$'
#   * generic: 가장 일반적인 유형의 Secret을 의미합니다.

# 시크릿 목록을 확인합니다 
kubectl get secret 

#시크릿 my-db-credentials 의 상세 정보를 확인합니다 
kubectl describe secrets my-db-credentials

#
#시크릿 my-db-credentials 의 상세 정보를 yaml 파일로 출력합니다 
kubectl get secrets my-db-credentials -o yaml

#base64로 암호화된 문자열을 확인할 수 있습니다  
```

방법 2: 파일로부터 만들기

  이미 파일로 저장된 비밀 정보를 Secret으로 만들 때 사용합니다. 각 파일의 이름이 key가 되고, 파일 내용이 value가 됩니다.

```

#비밀 정보 파일 준비 (-n 옵션은 불필요한 줄바꿈 문자가 들어가지 않게 해줍니다)

echo -n 'kosa' > ./username.txt
echo -n 'kosa1004$' > ./password.txt

#파일로부터 Secret 생성

kubectl create secret generic my-db-credentials-from-file \
      --from-file=DB_USER=./username.txt \
      --from-file=DB_PASSWORD=./password.txt


```

방법 3: YAML 파일로 선언하여 만들기 (권장)

  GitOps 등 버전 관리에 용이하여 가장 권장되는 방법입니다. YAML 파일에 값을 넣기 전에 직접 Base64로 인코딩해야 합니다.

```
#데이터를 Base64로 인코딩

# 사용자 이름 인코딩
echo -n 'kosa' | base64
# 결과: a29zYQ==

# 비밀번호 인코딩
echo -n 'kosa1004$' | base64
# 결과: a29zYTEwMDQk

# `secret.yaml` 파일 작성 data 필드에 인코딩된 값을 붙여넣습니다.
#vi secret.yaml
# secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-db-credentials-yaml
type: Opaque # 'generic'과 동일한 기본 유형
data:
  DB_USER: a29zYQ==
  DB_PASSWORD: a29zYTEwMDQk

#YAML 파일 적용
kubectl apply -f secret.yaml
```

  ---

  3. 파드(Pod)에서 Secret 사용하기

  생성한 Secret을 파드에서 사용하는 방법은 ConfigMap과 거의 동일합니다.

  방법 1: 환경 변수(Environment Variable)로 주입

  Secret의 값을 파드의 환경 변수로 주입합니다. 애플리케이션 코드에서는 이 환경 변수를 읽어서 사용합니다.
```
# pod-with-secret-env.yaml
vi pod-with-secret-env.yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app-pod
spec:
  containers:
    - name: my-app-container
      image: busybox
      command: 
        - /bin/sh
        - -c
        - |
          env | grep DATABASE_ # 컨테이너의 모든 환경 변수 출력
          echo "--- sleep 1시간 기다림 ---"
          sleep 3600 
      # DB 관련 환경변수만 출력
      env:
        - name: DB_USER     # 파드에서 사용할 환경 변수 이름
          valueFrom:
            secretKeyRef:
              name: my-db-credentials   # 사용할 Secret 이름
              key: DB_USER              # 사용할 Secret의 key
        - name: DB_PASSWORD # 파드에서 사용할 환경 변수 이름
          valueFrom:
            secretKeyRef:
              name: my-db-credentials   # 사용할 Secret 이름
              key: DB_PASSWORD          # 사용할 Secret의 key


```
  방법 2: 볼륨(Volume)으로 마운트하여 파일처럼 사용

  Secret의 데이터를 파일처럼 컨테이너의 특정 경로에 마운트합니다. TLS 인증서(tls.crt, tls.key)나, 여러
  비밀 값이 담긴 설정 파일을 전달할 때 매우 유용합니다.
```
# pod-with-secret-volume.yaml
vi pod-with-secret-volume.yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-app-pod-volume
spec:
  containers:
    - name: my-app-container
      image: busybox
      command: [ "/bin/sh", "-c", "ls -l /etc/db-credentials && sleep 3600" ]
      volumeMounts:
      - name: db-secret-volume
        mountPath: "/etc/db-credentials" # 이 경로에 Secret 데이터가 파일로 생성됨
        readOnly: true # Secret 볼륨은 읽기 전용으로 마운트하는 것이 보안상 좋음
  volumes:
    - name: db-secret-volume
      secret:
        secretName: my-db-credentials

```

  위 예제를 실행하면, 파드 내부의 /etc/db-credentials 디렉터리에 DB_USER와 DB_PASSWORD라는 두 개의 파일이 생성되고, 각 파일의 내용은 디코딩된 원래 값이 됩니다.

  보안을 위한 Best Practices

   * 최소 권한의 원칙: 파드에는 필요한 최소한의 Secret만 마운트하고, 가능하면 secretKeyRef를 사용해 필요한 키만 환경 변수로 주입하세요.
   * RBAC 강화: 일반 사용자들이나 불필요한 서비스 계정(Service Account)이 Secret을 get, list, watch 할 수 없도록 RBAC 정책을 엄격하게 설정하세요.
