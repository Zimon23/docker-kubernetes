 이 명령어는 디플로이먼트(Deployment)를 적용하면서, 변경 이력(change history)을 기록하는 중요한 옵션을 포함하고 있습니다.

```
kubectl apply -f deployment-nginx.yaml --record
```
  명령어 분석

   * `kubectl apply`: 리소스의 상태를 선언적으로 관리하는 명령어입니다. 리소스가 없으면 생성하고, 있으면 변경된 부분을 업데이트합니다.
   * `-f deployment-nginx.yaml`: -f 또는 --filename 플래그는 리소스의 구성(configuration)이 정의된 YAML 파일을 지정합니다.
   * `--record`: 이 명령어의 핵심입니다. 이 플래그는 실행된 kubectl 명령어를 해당 리소스의 어노테이션(annotation)에 기록하여, 나중에 변경 사유(CHANGE-CAUSE)를 확인할 수 있게 해줍니다.

  --record 플래그의 역할과 사용법

  --record 플래그를 사용하면, 디플로이먼트의 각 리비전(revision)이 어떤 명령에 의해 발생했는지 추적하기 쉬워집니다.

  1. `--record`를 사용하여 디플로이먼트 업데이트

   최초 배포 또는 업데이트 시 --record 플래그 사용
   ```
   kubectl apply -f deployment-nginx.yaml --record
   #nginx 이미지를 1.11 버전으로 변경 
   kubectl set image deployment my-nginx-deployment nginx=nginx:1.11 --record
   #nginx 이미지를 1.12 버전으로 변경 
   kubectl set image deployment my-nginx-deployment nginx=nginx:1.12 --record


   ```

  2. 변경 이력 확인

  kubectl rollout history 명령어를 사용하여 디플로이먼트의 배포 이력을 확인하면, CHANGE-CAUSE 열에 기록된 명령어를 볼
   수 있습니다.

   ```
   kubectl rollout history deployment my-nginx-deployment
   ```
  
  출력 예시:

   * `--record`를 사용했을 경우:

    deployment.apps/my-nginx-deployment
    REVISION  CHANGE-CAUSE
    1         kubectl apply --filename=deployment-nginx.yaml --record=true
    2         kubectl set image deployment my-nginx-deployment nginx=nginx:1.11 --record=true
    3         kubectl set image deployment my-nginx-deployment nginx=nginx:1.12 --record=true

   * `--record`를 사용하지 않았을 경우: CHANGE-CAUSE가 <none>으로 표시되어 변경 사유를 알기 어렵습니다.

   REVISION  CHANGE-CAUSE
   1         <none>
   2         <none>

  이처럼 --record는 어떤 변경이 있었는지 추적하는 데 도움을 주어, 문제가 발생했을 때 특정 리비전으로 롤백(kubectl rollout undo)하는 등 운영 작업을 더 쉽게 만들어 줍니다.

  ---

  ⚠️ 중요: --record 플래그는 폐기되었습니다 (Deprecated)

  매우 중요한 점은 `--record` 플래그는 최신 쿠버네티스 버전에서 공식적으로 폐기(deprecated)되었으며, 향후 버전에서는
  제거될 예정이라는 것입니다. 따라서 더 이상 사용하는 것을 권장하지 않습니다.

  현대적인 대안: kubernetes.io/change-cause 어노테이션 사용

  --record를 대체하는 현재 권장되는 방법은, YAML 파일의 metadata.annotations에 직접 변경 사유를 명시하는 것입니다.

  이 방법은 다음과 같은 장점이 있습니다.

   * 단순한 명령어 대신, 더 명확하고 서술적인 변경 사유를 남길 수 있습니다.
   * 변경 사유가 코드(YAML)의 일부가 되므로, Git과 같은 버전 관리 시스템으로 추적하기 용이합니다. (선언적 방식)

  YAML 파일 수정 예시:

  deployment-nginx-1.11.yaml 파일을 다음과 같이 수정합니다.
```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-nginx-deployment
  annotations:
    # 이 부분을 추가하여 변경 사유를 직접 기록합니다.
    kubernetes.io/change-cause: "Update nginx image to 1.11 for performance improvement"

spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-nginx
  template:
      name: my-nginx-pod
      labels:
        app: my-nginx
    spec:
      containers:
      - name: nginx
         # 이미지 버전을 1.11로 업데이트
        image: nginx:1.11
        ports:
        - containerPort: 80
```

#디플로이먼트 시작
#kubectl apply -f deployment-nginx.yaml

#디플로이먼트 이미지 변경
#kubectl apply -f deployment-nginx-1.11.yaml

  이렇게 수정한 뒤 kubectl apply를 실행하고 롤아웃 히스토리를 확인하면, CHANGE-CAUSE에 직접 작성한 설명이 표시됩니다.

